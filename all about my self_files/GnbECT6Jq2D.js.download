;/*FB_PKG_DELIM*/

__d("MAWBridgeUploadMessageGQLHandlerSingleTxn",["EncryptedBackupsWriteToMPSTables","I64","LSEncryptedBackupsBackupTenancy","LSIntEnum","MAWBridgeGQLUploadUtils","MAWEBFrontendQPLLogger","MAWEncryptedBackupUtils","MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBODSUtils","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsStateUtils","ODS","Promise","WAResultOrError","asyncToGeneratorRuntime","gkx","isInstamadilloEB","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(c("isInstamadilloEB")()){d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(e,"upload_tracking_gql_cancelled_instamadillo");return d("WAResultOrError").makeError("gql_cancelled_instamadillo")}d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(e,"upload_tracking_gql_handler_single_txn_start");var g="mps_write_failure",h=(yield a.runInTransaction(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var f=(yield d("MAWEncryptedBackupUtils").getBackupTenancy(b));if(f==null||!(i||(i=d("I64"))).equal(f,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))){e.forEach(function(b){if(b.uploadTrackingInstanceKey!=null){var e;b=b.uploadTrackingInstanceKey;d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(b,"user_device_not_enrolled_invalid_gql_request");var f=d("MWEBUseLocalStorage").mwEBGetIsLocalStorageEntryValuePresent(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);e=(e=d("MWEBUseLocalStorage").mwEBGetLocalStorageEntryValue(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE))!=null?e:"no";f={bool:{wasEBEnabledPreviously:f},string:{wasEBSMWiped:e}};d("MAWEBFrontendQPLLogger").endEBUploadTracking(b,f)}c("gkx")("8733")&&c("promiseDone")(d("MWEncryptedBackupsStateUtils").getEncryptedBackupState(a),function(a){a!==3&&(k||(k=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EB_SWITCH_CONSISTENCY,c("MWEBODSEntityKey.enum").FAIL),d("MWEncryptedBackupsStateUtils").setEBSwitch(a)})});f=[];g="user_device_not_enrolled";return f}else{d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(e,"upload_tracking_gql_handler_mps_write_start");f=(yield m(b,e));d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(e,"upload_tracking_gql_handler_mps_write_end");return f}});return function(a){return f.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":73"));h=h.filter(Boolean);if(h.length===0)return d("WAResultOrError").makeError(g);(k||(k=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,"graphql.batch.size."+h.length);k.bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,"graphql.batch.bucket"+d("MWEBODSUtils").getBucketName(h.length));d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(e,"upload_tracking_gql_handler_upload_start");h=(yield d("MAWBridgeGQLUploadUtils").uploadMessageOverGQL(a,h));d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(e,"upload_tracking_gql_handler_single_txn_end");return h});return l.apply(this,arguments)}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e=e.map(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var f=e.protoMsg;if(c("gkx")("23966")&&f!=null){f=f.backupActionType===1?(h||(h=b("Promise"))).all([d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(a,f,e.threadId,!1),d("EncryptedBackupsWriteToMPSTables").writeTagsToMPSTables(a,f,e.threadId)]):d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(a,f,e.threadId,!1);f=(yield f.then(function(){return e},function(a){e.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").failEBUploadTracking(e.uploadTrackingInstanceKey,"upload_tracking_gql_handler_failed_mps_write",{string:{error:a.message,errorMsgType:e.messageType}});return null}));return f}return e});return function(a){return e.apply(this,arguments)}}());e=(yield (h||(h=b("Promise"))).all(e));return e.filter(Boolean)});return n.apply(this,arguments)}g.call=a}),98);
__d("MAWPreloadSecureMessagesEager",["MAWPreloadSecureMessages","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return(h||(h=b("Promise"))).resolve(d("MAWPreloadSecureMessages").preloadSecureMessages)}g.load=a}),98);